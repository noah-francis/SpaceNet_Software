function [M]=Covariace4TDoA(Y,k,r,sig_t)
% Sorry these equaitons where deirved using symbolic variables to produce
% these 

c=299792458; %m/s


x1=k(1);
y1=k(2);
z1=k(3);

x2=k(4);
y2=k(5);
z2=k(6);


x3=k(7);
y3=k(8);
z3=k(9);

x4=k(10);
y4=k(11);
z4=k(12);

x=r(1);
y=r(2);
z=r(3);


dedy = eye(4);
dedy(1,1)=0;
       %
dedk =[                                                                                0,                                                                                0,                                                                                0,                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0;
-(2*conj(x) - 2*conj(x1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))), -(2*conj(y) - 2*conj(y1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))), -(2*conj(z) - 2*conj(z1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))), (2*conj(x) - 2*conj(x2))/(2*conj(((x - x2)^2 + (y - y2)^2 + (z - z2)^2)^(1/2))), (2*conj(y) - 2*conj(y2))/(2*conj(((x - x2)^2 + (y - y2)^2 + (z - z2)^2)^(1/2))), (2*conj(z) - 2*conj(z2))/(2*conj(((x - x2)^2 + (y - y2)^2 + (z - z2)^2)^(1/2))),                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0;
-(2*conj(x) - 2*conj(x1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))), -(2*conj(y) - 2*conj(y1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))), -(2*conj(z) - 2*conj(z1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))),                                                                               0,                                                                               0,                                                                               0, (2*conj(x) - 2*conj(x3))/(2*conj(((x - x3)^2 + (y - y3)^2 + (z - z3)^2)^(1/2))), (2*conj(y) - 2*conj(y3))/(2*conj(((x - x3)^2 + (y - y3)^2 + (z - z3)^2)^(1/2))), (2*conj(z) - 2*conj(z3))/(2*conj(((x - x3)^2 + (y - y3)^2 + (z - z3)^2)^(1/2))),                                                                               0,                                                                               0,                                                                               0;
-(2*conj(x) - 2*conj(x1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))), -(2*conj(y) - 2*conj(y1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))), -(2*conj(z) - 2*conj(z1))/(2*conj(((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2))),                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0,                                                                               0, (2*conj(x) - 2*conj(x4))/(2*conj(((x - x4)^2 + (y - y4)^2 + (z - z4)^2)^(1/2))), (2*conj(y) - 2*conj(y4))/(2*conj(((x - x4)^2 + (y - y4)^2 + (z - z4)^2)^(1/2))), (2*conj(z) - 2*conj(z4))/(2*conj(((x - x4)^2 + (y - y4)^2 + (z - z4)^2)^(1/2)))];
 
dedr = [                                                                                                                             0,                                                                                                                             0,                                                                                                                             0;
(2*x - 2*x1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*x - 2*x2)/(2*((x - x2)^2 + (y - y2)^2 + (z - z2)^2)^(1/2)), (2*y - 2*y1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*y - 2*y2)/(2*((x - x2)^2 + (y - y2)^2 + (z - z2)^2)^(1/2)), (2*z - 2*z1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*z - 2*z2)/(2*((x - x2)^2 + (y - y2)^2 + (z - z2)^2)^(1/2));
(2*x - 2*x1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*x - 2*x3)/(2*((x - x3)^2 + (y - y3)^2 + (z - z3)^2)^(1/2)), (2*y - 2*y1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*y - 2*y3)/(2*((x - x3)^2 + (y - y3)^2 + (z - z3)^2)^(1/2)), (2*z - 2*z1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*z - 2*z3)/(2*((x - x3)^2 + (y - y3)^2 + (z - z3)^2)^(1/2));
(2*x - 2*x1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*x - 2*x4)/(2*((x - x4)^2 + (y - y4)^2 + (z - z4)^2)^(1/2)), (2*y - 2*y1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*y - 2*y4)/(2*((x - x4)^2 + (y - y4)^2 + (z - z4)^2)^(1/2)), (2*z - 2*z1)/(2*((x - x1)^2 + (y - y1)^2 + (z - z1)^2)^(1/2)) - (2*z - 2*z4)/(2*((x - x4)^2 + (y - y4)^2 + (z - z4)^2)^(1/2))];
%  
dedr=[zeros(4,1),dedr];
M=pinv(dedr)*[dedy dedk];
end